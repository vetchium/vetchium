BEGIN;

-- First, clean up timeline data
DELETE FROM hu_home_timelines
WHERE hub_user_id IN (
    '12345678-0024-0024-0024-000000000001',
    '12345678-0024-0024-0024-000000000002',
    '12345678-0024-0024-0024-000000000003',
    '12345678-0024-0024-0024-000000000004',
    '12345678-0024-0024-0024-000000000005',
    '12345678-0024-0024-0024-000000000006',
    '12345678-0024-0024-0024-000000000007',
    '12345678-0024-0024-0024-000000000008',
    '12345678-0024-0024-0024-000000000009',
    '12345678-0024-0024-0024-000000000010',
    '12345678-0024-0024-0024-000000000011',
    '12345678-0024-0024-0024-000000000012',
    '12345678-0024-0024-0024-000000000013',
    '12345678-0024-0024-0024-000000000014',
    '12345678-0024-0024-0024-000000000015'
) OR (item_id LIKE 'post-0024-%' AND item_type = 'USER_POST'::timeline_item_types);

DELETE FROM hu_active_home_timelines
WHERE hub_user_id IN (
    '12345678-0024-0024-0024-000000000001',
    '12345678-0024-0024-0024-000000000002',
    '12345678-0024-0024-0024-000000000003',
    '12345678-0024-0024-0024-000000000004',
    '12345678-0024-0024-0024-000000000005',
    '12345678-0024-0024-0024-000000000006',
    '12345678-0024-0024-0024-000000000007',
    '12345678-0024-0024-0024-000000000008',
    '12345678-0024-0024-0024-000000000009',
    '12345678-0024-0024-0024-000000000010',
    '12345678-0024-0024-0024-000000000011',
    '12345678-0024-0024-0024-000000000012',
    '12345678-0024-0024-0024-000000000013',
    '12345678-0024-0024-0024-000000000014',
    '12345678-0024-0024-0024-000000000015'
);

-- Clean up follow relationships
DELETE FROM following_relationships
WHERE consuming_hub_user_id IN (
    '12345678-0024-0024-0024-000000000001',
    '12345678-0024-0024-0024-000000000002',
    '12345678-0024-0024-0024-000000000003',
    '12345678-0024-0024-0024-000000000004',
    '12345678-0024-0024-0024-000000000005',
    '12345678-0024-0024-0024-000000000006',
    '12345678-0024-0024-0024-000000000007',
    '12345678-0024-0024-0024-000000000008',
    '12345678-0024-0024-0024-000000000009',
    '12345678-0024-0024-0024-000000000010',
    '12345678-0024-0024-0024-000000000011',
    '12345678-0024-0024-0024-000000000012',
    '12345678-0024-0024-0024-000000000013',
    '12345678-0024-0024-0024-000000000014',
    '12345678-0024-0024-0024-000000000015'
) OR producing_hub_user_id IN (
    '12345678-0024-0024-0024-000000000001',
    '12345678-0024-0024-0024-000000000002',
    '12345678-0024-0024-0024-000000000003',
    '12345678-0024-0024-0024-000000000004',
    '12345678-0024-0024-0024-000000000005',
    '12345678-0024-0024-0024-000000000006',
    '12345678-0024-0024-0024-000000000007',
    '12345678-0024-0024-0024-000000000008',
    '12345678-0024-0024-0024-000000000009',
    '12345678-0024-0024-0024-000000000010',
    '12345678-0024-0024-0024-000000000011',
    '12345678-0024-0024-0024-000000000012',
    '12345678-0024-0024-0024-000000000013',
    '12345678-0024-0024-0024-000000000014',
    '12345678-0024-0024-0024-000000000015'
);

-- Very important: Clean up post_tags BEFORE attempting to clean up posts
-- First, get all post IDs from test users
DELETE FROM post_tags
WHERE post_id IN (
    SELECT id FROM posts 
    WHERE author_id::text LIKE '12345678-0024-0024-0024-%'
);

-- Also clean up specifically named posts
DELETE FROM post_tags
WHERE post_id LIKE 'post-0024-%';

-- Now clean up any other post tags that might have been created during tests
DELETE FROM post_tags
WHERE post_id IN (
    SELECT p.id FROM posts p
    JOIN hub_users u ON p.author_id = u.id
    WHERE u.handle LIKE '%timeline-user%-0024'
);

-- Now safe to clean up posts
DELETE FROM posts
WHERE id LIKE 'post-0024-%' OR author_id::text LIKE '12345678-0024-0024-0024-%';

-- Also clean up posts created by timeline users (based on handle)
DELETE FROM posts
WHERE author_id IN (
    SELECT id FROM hub_users
    WHERE handle LIKE '%timeline-user%-0024'
);

-- Clean up tags
DELETE FROM tags
WHERE id IN (
    '12345678-0024-0024-0024-000000000001',
    '12345678-0024-0024-0024-000000000002',
    '12345678-0024-0024-0024-000000000003',
    '12345678-0024-0024-0024-000000000004'
);

-- Clean up hub user tokens and related tables
DELETE FROM hub_user_tfa_codes
WHERE tfa_token IN (
    SELECT token FROM hub_user_tokens
    WHERE hub_user_id::text LIKE '12345678-0024-0024-0024-%'
);

DELETE FROM hub_user_tokens
WHERE hub_user_id::text LIKE '12345678-0024-0024-0024-%';

-- Clean up hub users
DELETE FROM hub_users
WHERE id::text LIKE '12345678-0024-0024-0024-%';

COMMIT;
